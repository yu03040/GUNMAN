# EnemyAnimInstance クラスの概要

## 主な処理内容

`EnemyAnimInstance` クラスは、`UAnimInstance` を継承しており、敵AIのアニメーションを制御するためのクラスです。このクラスは、敵キャラクターが地面に接地しているかどうか、移動速度、方向、武器を構えているかどうかなどの情報を基にアニメーションの更新を行います。

- **接地の設定**: 敵キャラクターが空中にいるかどうかの状態を追跡し、接地判定をアニメーションに反映します。
- **方向と速度の設定**: 敵キャラクターの移動速度と方向を取得し、1Dブレンドスペースなどで使用します。
- **武器の構え**: キャラクターの制御回転を基に、武器の構える向きを計算し、エイミングのアニメーションに適用します。

## このクラスのソースコードの説明

### コンストラクター `（UEnemyAnimInstance::UEnemyAnimInstance)`
- **基本的な初期化**: コンストラクターでは特に初期化は行っていませんが、クラス自体の構築を行うために存在しています。

### `NativeBeginPlay` 関数
- **敵キャラクターの参照取得**: `NativeBeginPlay()` 関数で、このアニメーションインスタンスが属するキャラクター（`EnemyCharacterRef`）を取得しています。`TryGetPawnOwner()` を使用して、現在のポーン（キャラクター）を取得し、それを `ACharacter` 型にキャストしています。

### `NativeUpdateAnimation` 関数
- **毎フレームアニメーションの更新**: `NativeUpdateAnimation()` 関数は毎フレーム呼び出され、アニメーションに必要な情報を更新します。`DeltaTime` はアニメーションのタイミング調整に使用されます。
  
- **接地判定**:
  - `EnemyCharacterRef->GetMovementComponent()->IsFalling()` を使用して、キャラクターが空中にいるかどうかを判定し、`bIsInAir` に設定しています。これにより、アニメーションステートマシンが適切なステートを選択します。

- **移動速度の取得**:
  - `GetVelocity().Size()` を使用してキャラクターの速度を計算し、`Speed` に代入します。この値は、移動中や静止中のアニメーションを切り替えるために使用されます。

- **方向の取得**:
  - キャラクターの速度ベクトル（`Velocity`）と、キャラクターの現在の回転（`BaseRotation`）を基に、移動方向を `UKismetAnimationLibrary::CalculateDirection` を使って計算します。結果は `Direction` に保存され、移動方向に基づくアニメーションを制御します。

- **武器の構え方向の計算**:
  - `AimPitch` と `AimYaw` はキャラクターが武器を構える際のピッチとヨーの角度を制御します。`UKismetMathLibrary::RInterpTo()` を使用して、キャラクターの現在の回転とターゲットの回転との間を滑らかに補間し、これらの角度を計算します。
  - 最終的に、計算された角度は `UKismetMathLibrary::ClampAngle()` によって制限され、ピッチ角とヨー角が適切な範囲内に収められます。