# BaseMapScript クラスの概要

## 主な処理内容

![Level_ClassDiagrams](Images/Level_ClassDiagrams.png)

`BaseMapScript` クラスは、Unreal Engine の `LevelScriptActor` を継承したクラスで、マップごとに異なるレベルブループリントの処理をコードで管理する基底クラスです。このクラスは、すべてのマップにおける共通のUI操作やボタン選択の機能を実装しています。

- **主な機能**:
  - UI 操作をコントローラーで行うための関数を定義
  - 選択されたボタンの色を変更する処理を仮想関数として提供
  - 選択されたボタンによって実行されるアクションを仮想関数として提供
  - 操作説明のキャンバスに移動したかどうかを管理するプロパティ
  - 選択しているボタンのインデックスを管理し、上下の操作でボタンを循環させる

## 関数の説明

### コンストラクター `ABaseMapScript()`

- **初期化**:
  - `HasMovedToInstructions` は `false` で初期化され、操作説明のキャンバスに移動していないことを示します。
  - `ButtonCounter` は `1` で初期化され、UI の最初のボタンが選択状態になるようにしています。

### `UI_UpwardMovement()` 関数

- **役割**: コントローラーの入力に応じて、UI のボタンを上に移動させます。
- **動作**:
  - 操作説明のキャンバスにいる場合はボタンの移動を無効化します（`HasMovedToInstructions` が `true` の場合）。
  - ボタンのインデックス（`ButtonCounter`）をデクリメントして上のボタンを選択します。もしインデックスが `0` 以下になった場合、最下部のボタン（`MaxButtonCounter`）が選択されるようにします。
  - ボタンが移動するたびに `ChangeButtonColor()` 関数で選択状態の色を変更します。

### `UI_DownwardMovement()` 関数

- **役割**: コントローラーの入力に応じて、UI のボタンを下に移動させます。
- **動作**:
  - 操作説明のキャンバスにいる場合はボタンの移動を無効化します。
  - ボタンのインデックス（`ButtonCounter`）をインクリメントして下のボタンを選択します。もしインデックスが `InvalidButtonIndex` 以上になった場合、最上部のボタン（インデックス `1`）が選択されるようにします。
  - こちらもボタンが移動するたびに `ChangeButtonColor()` 関数が呼ばれます。

### `ChangeButtonColor()` 関数

- **仮想関数**: この関数は、選択状態から非選択状態に遷移する際にボタンの色を変更する機能を持っていますが、具体的な実装はサブクラスで行うことを想定しています。つまり、UI 操作の見た目を変えたい場合に、この関数をオーバーライドして使用します。

### `UpdateOutputButton()` 関数

- **仮想関数**: ボタンが選択された際に実行される処理を定義するための関数です。ボタンのクリックイベントや関連するUIの処理を行いますが、実装はサブクラスで行われます。

### `BeginPlay()` 関数

- **役割**: ゲーム開始時またはスポーン時に実行される関数。`Super::BeginPlay()` を呼び出して、`LevelScriptActor` の標準的な処理を継承しつつ、必要に応じた追加の初期化処理をサブクラスで実装することができます。